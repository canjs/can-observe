<!DOCTYPE html>

<html>
<head>
  <title>-make-object.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="array.html">
                  array.js
                </a>
              
                
                <a class="source" href="can-observe.html">
                  can-observe.js
                </a>
              
                
                <a class="source" href="object.html">
                  object.js
                </a>
              
                
                <a class="source" href="-getter-helpers.html">
                  -getter-helpers.js
                </a>
              
                
                <a class="source" href="-helpers.html">
                  -helpers.js
                </a>
              
                
                <a class="source" href="-make-array.html">
                  -make-array.js
                </a>
              
                
                <a class="source" href="-make-function.html">
                  -make-function.js
                </a>
              
                
                <a class="source" href="-make-object.html">
                  -make-object.js
                </a>
              
                
                <a class="source" href="-make-observe.html">
                  -make-observe.js
                </a>
              
                
                <a class="source" href="-make-simple-function.html">
                  -make-simple-function.js
                </a>
              
                
                <a class="source" href="-memoize-getter-test.html">
                  -memoize-getter-test.js
                </a>
              
                
                <a class="source" href="-memoize-getter.html">
                  -memoize-getter.js
                </a>
              
                
                <a class="source" href="-observable-store.html">
                  -observable-store.js
                </a>
              
                
                <a class="source" href="-symbols.html">
                  -symbols.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="-make-object-js">-make-object.js</h1>
<p>This module’s <code>.observable</code> method proxies an object to make it observable.
The other exports are used by other make-TYPE modules.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> canReflect = <span class="hljs-built_in">require</span>(<span class="hljs-string">"can-reflect"</span>);
<span class="hljs-keyword">var</span> ObservationRecorder = <span class="hljs-built_in">require</span>(<span class="hljs-string">"can-observation-recorder"</span>);
<span class="hljs-keyword">var</span> mapBindings = <span class="hljs-built_in">require</span>(<span class="hljs-string">"can-event-queue/map/map"</span>);

<span class="hljs-keyword">var</span> symbols = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./-symbols"</span>);
<span class="hljs-keyword">var</span> observableStore = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./-observable-store"</span>);
<span class="hljs-keyword">var</span> helpers = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./-helpers"</span>);

<span class="hljs-keyword">var</span> hasOwn = <span class="hljs-built_in">Object</span>.prototype.hasOwnProperty;
<span class="hljs-keyword">var</span> isSymbolLike = canReflect.isSymbolLike;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>These are the “overwrites” for the proxy.
Copy the symbols from the map bindings mixin.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> proxyKeys = <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>);
<span class="hljs-built_in">Object</span>.getOwnPropertySymbols(mapBindings).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">symbol</span>)</span>{
	proxyKeys[symbol] = mapBindings[symbol];
});

<span class="hljs-keyword">var</span> makeObject = {</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Returns a proxied version of the object.</p>
<ul>
<li><code>object</code> - An object to proxy.</li>
<li><code>options</code> - Configurable behaviors.<ul>
<li><code>proxyKeys</code> - Keys that will override any keys on <code>object</code>. Defaults to <code>makeObject.proxyKeys</code>.</li>
<li><code>observe(nonObservable)</code> - A function that converts a nested value to an observable.</li>
<li><code>shouldRecordObservation(keyInfo, meta)</code> - Returns if <code>ObservationRecorder</code>
should be called.  Defaults to <code>makeObject.shouldRecordObservationOnOwnAndMissingKeys</code>.</li>
</ul>
</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>	observable: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">object, options</span>) </span>{
		<span class="hljs-keyword">if</span>(options.shouldRecordObservation === <span class="hljs-literal">undefined</span>) {
			options.shouldRecordObservation = makeObject.shouldRecordObservationOnOwnAndMissingKeys;
		}

		<span class="hljs-keyword">var</span> meta = {
			<span class="hljs-attr">target</span>: object,
			<span class="hljs-attr">proxyKeys</span>: options.proxyKeys !== <span class="hljs-literal">undefined</span> ? options.proxyKeys : <span class="hljs-built_in">Object</span>.create(makeObject.proxyKeys()),
			<span class="hljs-attr">options</span>: options,</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p><code>preventSideEffects</code> is a counter used to “turn off” the proxy.  This is incremented when some
function (like <code>Array.splice</code>) wants to handle event dispatching and/or calling
<code>ObservationRecorder</code> itself for performance reasons.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			preventSideEffects: <span class="hljs-number">0</span>
		};

		meta.proxyKeys[symbols.metaSymbol] = meta;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>We <code>bind</code> so the <code>meta</code> is immediately available as <code>this</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		meta.proxy = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Proxy</span>(object, {
			<span class="hljs-attr">get</span>: makeObject.get.bind(meta),
			<span class="hljs-attr">set</span>: makeObject.set.bind(meta),
			<span class="hljs-attr">ownKeys</span>: makeObject.ownKeys.bind(meta),
			<span class="hljs-attr">deleteProperty</span>: makeObject.deleteProperty.bind(meta),
			<span class="hljs-attr">meta</span>: meta
		});
		mapBindings.addHandlers(meta.proxy, meta);
		<span class="hljs-keyword">return</span> meta.proxy;
	},
	<span class="hljs-attr">proxyKeys</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
		<span class="hljs-keyword">return</span> proxyKeys;
	},</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p><code>get</code> checks the target for un-proxied objects.
If it finds an un-proxied object:</p>
<ul>
<li>it creates one (which registers itself in the observableStore) and</li>
<li>returns the proxied value without modifying the underlying target</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>	get: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">target, key, receiver</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>If getting a key for the proxy, return that value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> proxyKey = <span class="hljs-keyword">this</span>.proxyKeys[key];
		<span class="hljs-keyword">if</span> (proxyKey !== <span class="hljs-literal">undefined</span>) {
			<span class="hljs-keyword">return</span> proxyKey;
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Symbols are not observable and their values are not made observable.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span> (isSymbolLike(key)) {
			<span class="hljs-keyword">return</span> target[key];
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Gets information about the key on <code>target</code> or on <code>target</code>‘s prototype.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> keyInfo = makeObject.getKeyInfo(target, key, receiver, <span class="hljs-keyword">this</span>);
		<span class="hljs-keyword">var</span> value = keyInfo.targetValue;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>If the return value can be changed …</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span> (!keyInfo.valueIsInvariant) {</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Convert the value into an observable
or get it if already converted from the store.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			value = makeObject.getValueFromStore(key, value, <span class="hljs-keyword">this</span>);
		}

		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.options.shouldRecordObservation(keyInfo, <span class="hljs-keyword">this</span>)) {
			ObservationRecorder.add(<span class="hljs-keyword">this</span>.proxy, key.toString());
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>if the parent object is observable, we need to observe there too.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span> (keyInfo.parentObservableGetCalledOn) {
			ObservationRecorder.add(keyInfo.parentObservableGetCalledOn, key.toString());
		}
		<span class="hljs-keyword">return</span> value;
	},</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p><code>set</code> is called when a property is set on the proxy or an object
that has the proxy on its prototype.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	set: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">target, key, value, receiver</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>If the receiver is not this observable (the observable might be on the proto chain),
set the key on the reciever.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span> (receiver !== <span class="hljs-keyword">this</span>.proxy) {
			<span class="hljs-keyword">return</span> makeObject.setKey(receiver, key, value, <span class="hljs-keyword">this</span>);
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Gets the observable value to set.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		value = makeObject.getValueToSet(key, value, <span class="hljs-keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Sets the value on the target.  If there
is a change, calls the callback.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		makeObject.setValueAndOnChange(key, value, <span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key, value, meta, hadOwn, old</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>!steal-remove-start</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span> reasonLog = [canReflect.getName(meta.proxy)+<span class="hljs-string">" set"</span>, key,<span class="hljs-string">"to"</span>, value];</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>!steal-remove-end</p>

            </div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Fire event handlers for this key change.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			mapBindings.dispatch.call( meta.proxy, {
				<span class="hljs-attr">type</span>: key,</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>!steal-remove-start</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-comment">/* jshint laxcomma: true */</span>
				reasonLog: reasonLog,
				<span class="hljs-comment">/* jshint laxcomma: false */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>!steal-remove-end</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				patches: [{
					<span class="hljs-attr">key</span>: key,
					<span class="hljs-attr">type</span>: hadOwn ? <span class="hljs-string">"set"</span> : <span class="hljs-string">"add"</span>,
					<span class="hljs-attr">value</span>: value
				}],
				<span class="hljs-attr">keyChanged</span>: !hadOwn ? key : <span class="hljs-literal">undefined</span>
			},[value, old]);

		});

		<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
	},</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p><code>deleteProperty</code> is called when a property is deleted on the proxy.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	deleteProperty: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">target, key</span>) </span>{

		<span class="hljs-keyword">var</span> old = <span class="hljs-keyword">this</span>.target[key],
			deleteSuccessful = <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.target[key];</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Fire event handlers if we were able to delete and the value changed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span> (deleteSuccessful &amp;&amp; <span class="hljs-keyword">this</span>.preventSideEffects === <span class="hljs-number">0</span> &amp;&amp; old !== <span class="hljs-literal">undefined</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>!steal-remove-start</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span> reasonLog = [canReflect.getName(<span class="hljs-keyword">this</span>.proxy)+<span class="hljs-string">" deleted"</span>, key];</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>!steal-remove-end</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
			mapBindings.dispatch.call( <span class="hljs-keyword">this</span>.proxy, {
				<span class="hljs-attr">type</span>: key,</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>!steal-remove-start</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-comment">/* jshint laxcomma: true */</span>
				reasonLog: reasonLog,
				<span class="hljs-comment">/* jshint laxcomma: false */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>!steal-remove-end</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				patches: [{
					<span class="hljs-attr">key</span>: key,
					<span class="hljs-attr">type</span>: <span class="hljs-string">"delete"</span>
				}],
				<span class="hljs-attr">keyChanged</span>: key
			},[<span class="hljs-literal">undefined</span>, old]);

		}
		<span class="hljs-keyword">return</span> deleteSuccessful;
	},</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p><code>ownKeys</code> returns the proxies keys.
Proxies should return the keys and symbols from proxyOnly
as well as from the target, so operators like <code>in</code> and
functions like <code>hasOwnProperty</code> can be used to determine
that the Proxy is observable.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	ownKeys: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">target, key</span>) </span>{
		ObservationRecorder.add(<span class="hljs-keyword">this</span>.proxy, symbols.keysSymbol);

		<span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.getOwnPropertyNames(<span class="hljs-keyword">this</span>.target)
			.concat(<span class="hljs-built_in">Object</span>.getOwnPropertySymbols(<span class="hljs-keyword">this</span>.target))
			.concat(<span class="hljs-built_in">Object</span>.getOwnPropertySymbols(<span class="hljs-keyword">this</span>.proxyKeys));
	},</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Returns a <code>keyInfo</code> object with useful information about the key
and its value.  This function is <em>heavily</em> optimized.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	getKeyInfo: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">target, key, receiver, meta</span>) </span>{
		<span class="hljs-keyword">var</span> descriptor = <span class="hljs-built_in">Object</span>.getOwnPropertyDescriptor(target, key);
		<span class="hljs-keyword">var</span> propertyInfo = {</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>The key being read.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			key: key,</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>The property descriptor.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			descriptor: descriptor,</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>If the <code>target</code> has the key.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			targetHasOwnKey: <span class="hljs-built_in">Boolean</span>(descriptor),</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>If the proxy is on the proto chain.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			getCalledOnParent: receiver !== meta.proxy,</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>If the prototype of the target has this key.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			protoHasKey: <span class="hljs-literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>If the property is sealed or not.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			valueIsInvariant: <span class="hljs-literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>The value of the key wherever it is found.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			targetValue: <span class="hljs-literal">undefined</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>If reading the key went through a getter.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			isAccessor: <span class="hljs-literal">false</span>
		};
		<span class="hljs-keyword">if</span> (propertyInfo.getCalledOnParent === <span class="hljs-literal">true</span>) {
			propertyInfo.parentObservableGetCalledOn = observableStore.proxiedObjects.get(receiver);
		}
		<span class="hljs-keyword">if</span> (descriptor !== <span class="hljs-literal">undefined</span>) {
			propertyInfo.valueIsInvariant = descriptor.writable === <span class="hljs-literal">false</span>;
			<span class="hljs-keyword">if</span> (descriptor.get !== <span class="hljs-literal">undefined</span>) {
				propertyInfo.targetValue = descriptor.get.call( propertyInfo.parentObservableGetCalledOn || receiver);
				propertyInfo.isAccessor = <span class="hljs-literal">true</span>;
			} <span class="hljs-keyword">else</span> {
				propertyInfo.targetValue = descriptor.value;
			}
		} <span class="hljs-keyword">else</span> {
			propertyInfo.targetValue = meta.target[key];
			propertyInfo.protoHasKey = propertyInfo.targetValue !== <span class="hljs-literal">undefined</span> ? <span class="hljs-literal">true</span> : (key <span class="hljs-keyword">in</span> target);
		}

		<span class="hljs-keyword">return</span> propertyInfo;
	},</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Returns <code>true</code> if <code>ObservationRecorder.add</code> should be called.
This is the default <code>options.shouldRecordObservation</code> behavior.
<code>observe.Object</code> changes this to record all keys except functions on the
proto chain.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	shouldRecordObservationOnOwnAndMissingKeys: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">keyInfo, meta</span>) </span>{
		<span class="hljs-keyword">return</span> meta.preventSideEffects === <span class="hljs-number">0</span> &amp;&amp;</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>The read is not a getter AND …</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			!keyInfo.isAccessor &amp;&amp;
			(</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>(the read is on the proxy OR</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				(keyInfo.targetHasOwnKey ) ||</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>it’s not on the proto chain and we are not sealed).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				(!keyInfo.protoHasKey &amp;&amp; !<span class="hljs-built_in">Object</span>.isSealed(meta.target))
			);
	},</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p><code>setKey</code> sets a value on an object. Use <code>Object.defineProperty</code>
because it won’t try setting up the proto chain.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	setKey: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">receiver, key, value</span>) </span>{
		<span class="hljs-built_in">Object</span>.defineProperty(receiver, key, {
			<span class="hljs-attr">value</span>: value,
			<span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
			<span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
			<span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>
		});
		<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
	},</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p><code>getValueToSet</code> gets the value we will set on the object.  It only
converts set values to observables if we have actually bound.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	getValueToSet: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key, value, meta</span>) </span>{
		<span class="hljs-keyword">if</span> (!canReflect.isSymbolLike(key) &amp;&amp; meta.handlers.getNode([key])) {
			<span class="hljs-keyword">return</span> makeObject.getValueFromStore(key, value, meta);
		}
		<span class="hljs-keyword">return</span> value;
	},</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Get a value from the store if we can.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	getValueFromStore: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key, value, meta</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>We never convert primitives or things that are already observable.
However, there are some builtIns that we premptively convert, namely
Array.prototype methods.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span> (!canReflect.isPrimitive(value) &amp;&amp;
			!canReflect.isObservableLike(value) &amp;&amp;</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Do nothing if the value is already a converted proxy.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			!observableStore.proxies.has(value)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>If the <code>value</code> already been made into a proxy, use the value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> (observableStore.proxiedObjects.has(value)) {
				value = observableStore.proxiedObjects.get(value);
			}
			<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!helpers.isBuiltInButNotArrayOrPlainObject(value)) {
				value = meta.options.observe(value);
			}
		}
		<span class="hljs-keyword">return</span> value;
	},</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p><code>setValueAndOnChange</code> sets the value.  If the value changed,
calls the <code>onChange</code> callback.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	setValueAndOnChange: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key, value, data, onChange</span>) </span>{
		<span class="hljs-keyword">var</span> old, change;
		<span class="hljs-keyword">var</span> hadOwn = hasOwn.call(data.target, key);

		<span class="hljs-keyword">var</span> descriptor = <span class="hljs-built_in">Object</span>.getOwnPropertyDescriptor(data.target, key);</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>call the setter on the Proxy to properly do any side-effect sets (and run corresponding handlers)
– setters do not return values, so it is unnecessary to check for changes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span> (descriptor &amp;&amp; descriptor.set) {
			descriptor.set.call(data.proxy, value);
		} <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>otherwise check for a changed value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			old = data.target[key];
			change = old !== value;
			<span class="hljs-keyword">if</span> (change) {
				data.target[key] = value;
				<span class="hljs-keyword">if</span> (data.preventSideEffects === <span class="hljs-number">0</span>) {
					onChange(key, value, data, hadOwn, old);
				}
			}
		}
	}
};


<span class="hljs-built_in">module</span>.exports = makeObject;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
