<!DOCTYPE html>

<html>
<head>
  <title>-memoize-getter-test.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="array.html">
                  array.js
                </a>
              
                
                <a class="source" href="can-observe.html">
                  can-observe.js
                </a>
              
                
                <a class="source" href="object.html">
                  object.js
                </a>
              
                
                <a class="source" href="-getter-helpers.html">
                  -getter-helpers.js
                </a>
              
                
                <a class="source" href="-helpers.html">
                  -helpers.js
                </a>
              
                
                <a class="source" href="-make-array.html">
                  -make-array.js
                </a>
              
                
                <a class="source" href="-make-function.html">
                  -make-function.js
                </a>
              
                
                <a class="source" href="-make-object.html">
                  -make-object.js
                </a>
              
                
                <a class="source" href="-make-observe.html">
                  -make-observe.js
                </a>
              
                
                <a class="source" href="-make-simple-function.html">
                  -make-simple-function.js
                </a>
              
                
                <a class="source" href="-memoize-getter-test.html">
                  -memoize-getter-test.js
                </a>
              
                
                <a class="source" href="-memoize-getter.html">
                  -memoize-getter.js
                </a>
              
                
                <a class="source" href="-observable-store.html">
                  -observable-store.js
                </a>
              
                
                <a class="source" href="-symbols.html">
                  -symbols.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>-memoize-getter-test.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> QUnit = <span class="hljs-built_in">require</span>(<span class="hljs-string">'steal-qunit'</span>);
<span class="hljs-keyword">var</span> memoizeGetter = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./-memoize-getter'</span>);
<span class="hljs-keyword">var</span> canReflect = <span class="hljs-built_in">require</span>(<span class="hljs-string">"can-reflect"</span>);
<span class="hljs-keyword">var</span> SimpleObservable = <span class="hljs-built_in">require</span>(<span class="hljs-string">"can-simple-observable"</span>);
<span class="hljs-keyword">var</span> Observation = <span class="hljs-built_in">require</span>(<span class="hljs-string">"can-observation"</span>);
<span class="hljs-keyword">var</span> canSymbol = <span class="hljs-built_in">require</span>(<span class="hljs-string">"can-symbol"</span>);

QUnit.module(<span class="hljs-string">'helpers/-memoize-getter'</span>);

QUnit.test(<span class="hljs-string">'basics'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">var</span> calls = [];
    <span class="hljs-keyword">var</span> Type = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">first, second</span>)</span>{
        <span class="hljs-keyword">this</span>.first = <span class="hljs-keyword">new</span> SimpleObservable(first);
        <span class="hljs-keyword">this</span>.second = <span class="hljs-keyword">new</span> SimpleObservable(second);
    };
    Type.prototype = {
        get fullName(){
            <span class="hljs-keyword">var</span> first = <span class="hljs-keyword">this</span>.first.get(),
                second = <span class="hljs-keyword">this</span>.second.get(),
                result = first + <span class="hljs-string">" "</span> + second;
            calls.push(<span class="hljs-string">"fullName "</span>+result);
            <span class="hljs-keyword">return</span> result;
        }
    };
    <span class="hljs-keyword">var</span> descriptor = <span class="hljs-built_in">Object</span>.getOwnPropertyDescriptor(Type.prototype, <span class="hljs-string">"fullName"</span>);
    <span class="hljs-keyword">var</span> getObservationDataFor = memoizeGetter(Type.prototype,<span class="hljs-string">"fullName"</span>,descriptor);

    <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">new</span> Type(<span class="hljs-string">"Justin"</span>,<span class="hljs-string">"Meyer"</span>);

    QUnit.equal(me.fullName, <span class="hljs-string">"Justin Meyer"</span>, <span class="hljs-string">"getter read"</span>);

    <span class="hljs-keyword">var</span> observationData = getObservationDataFor(me);

    canReflect.onValue(observationData.observation, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newVal</span>)</span>{
        calls.push(<span class="hljs-string">"binding "</span>+newVal);
    });
    <span class="hljs-keyword">var</span> res;

    res = me.fullName;
    res = me.fullName;

    me.first.set(<span class="hljs-string">"Ramiya"</span>);

    QUnit.deepEqual(calls,[
        <span class="hljs-string">"fullName Justin Meyer"</span>,
        <span class="hljs-string">"fullName Justin Meyer"</span>,
        <span class="hljs-string">"fullName Ramiya Meyer"</span>,
        <span class="hljs-string">"binding Ramiya Meyer"</span>
    ],<span class="hljs-string">"calls in right order"</span>);

});

QUnit.test(<span class="hljs-string">'works with observations'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">var</span> calls = [];
    <span class="hljs-keyword">var</span> Type = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">first, second</span>)</span>{
        <span class="hljs-keyword">this</span>.first = <span class="hljs-keyword">new</span> SimpleObservable(first);
        <span class="hljs-keyword">this</span>.second = <span class="hljs-keyword">new</span> SimpleObservable(second);
    };
    Type.prototype = {
        get fullName(){
            <span class="hljs-keyword">var</span> first = <span class="hljs-keyword">this</span>.first.get(),
                second = <span class="hljs-keyword">this</span>.second.get(),
                result = first + <span class="hljs-string">" "</span> + second;
            calls.push(<span class="hljs-string">"fullName "</span>+result);
            <span class="hljs-keyword">return</span> result;
        }
    };


    <span class="hljs-keyword">var</span> descriptor = <span class="hljs-built_in">Object</span>.getOwnPropertyDescriptor(Type.prototype, <span class="hljs-string">"fullName"</span>);
    <span class="hljs-keyword">var</span> getObservationDataFor = memoizeGetter(Type.prototype,<span class="hljs-string">"fullName"</span>,descriptor);

    Type.prototype[canSymbol.for(<span class="hljs-string">"can.onKeyValue"</span>)] = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key, handler, queue</span>)</span>{
        <span class="hljs-keyword">var</span> context = <span class="hljs-keyword">this</span>;
        calls.push(<span class="hljs-string">"me.onKeyValue "</span>+key);
        canReflect.onValue( getObservationDataFor(context).observation, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newVal</span>)</span>{
            calls.push(<span class="hljs-string">"me.onKeyValue observation handler"</span>);
            handler(newVal);
        },<span class="hljs-string">"notify"</span>);
    };

    <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">new</span> Type(<span class="hljs-string">"Justin"</span>,<span class="hljs-string">"Meyer"</span>);

    <span class="hljs-keyword">var</span> fullNameObservation = <span class="hljs-keyword">new</span> Observation(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        calls.push(<span class="hljs-string">"calculating observation"</span>);
        <span class="hljs-keyword">return</span> me.fullName;
    });

    canReflect.onValue(fullNameObservation, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newVal</span>)</span>{
        calls.push(<span class="hljs-string">"binding "</span>+newVal);
    });

    me.first.set(<span class="hljs-string">"Ramiya"</span>);

    QUnit.deepEqual(calls,[
        <span class="hljs-string">"calculating observation"</span>,
        <span class="hljs-string">"fullName Justin Meyer"</span>,
        <span class="hljs-string">"me.onKeyValue fullName"</span>,
        <span class="hljs-string">"fullName Ramiya Meyer"</span>,
        <span class="hljs-string">"me.onKeyValue observation handler"</span>,
        <span class="hljs-string">"calculating observation"</span>,
        <span class="hljs-string">"binding Ramiya Meyer"</span>
    ],<span class="hljs-string">"calls in right order"</span>);

});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
